(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     57971,       1598]
NotebookOptionsPosition[     53009,       1511]
NotebookOutlinePosition[     53404,       1528]
CellTagsIndexPosition[     53361,       1525]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"Clear", "[", "\"\<Global`*\>\"", "]"}]], "Input",
 CellChangeTimes->{{3.763780686307953*^9, 
  3.7637806970027785`*^9}},ExpressionUUID->"2d395793-0438-4fb6-b573-\
c8cc47d0d648"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{
  3.7637715333388844`*^9},ExpressionUUID->"d3bd016d-6cb7-4cc6-800d-\
06eabfbe5c2e"],

Cell[CellGroupData[{

Cell["NCM Algebra", "Section",
 CellChangeTimes->{{3.763834914497355*^9, 
  3.7638349199657393`*^9}},ExpressionUUID->"c9243699-47ec-4960-a666-\
41d202c80aca"],

Cell[CellGroupData[{

Cell["General functions", "Subsection",
 CellChangeTimes->{{3.7638352866403885`*^9, 
  3.7638352889980855`*^9}},ExpressionUUID->"c15a5372-ace8-4823-9bde-\
315fae516ec0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", 
   RowBox[{"ExpandNCM", ",", "sendNCM", ",", "AppToNCM"}], "]"}], "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"a", "[", "__", "]"}], " ", "to", " ", "represent", " ", 
     RowBox[{"fermion", "/", "boson"}], " ", "operator"}], ",", " ", 
    RowBox[{
     RowBox[{"d", "/", "o"}], " ", "represent", " ", "dagger", " ", "or", " ",
      "not"}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ExpandNCM", "[", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"h", ":", "NonCommutativeMultiply"}], ")"}], "[", 
    RowBox[{"a___", ",", "b_Plus", ",", "c___"}], "]"}], "]"}], ":=", 
  RowBox[{"Distribute", "[", 
   RowBox[{
    RowBox[{"h", "[", 
     RowBox[{"a", ",", "b", ",", "c"}], "]"}], ",", "Plus", ",", "h", ",", 
    "Plus", ",", 
    RowBox[{
     RowBox[{"ExpandNCM", "[", 
      RowBox[{"h", "[", "##", "]"}], "]"}], "&"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ExpandNCM", "[", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"h", ":", "NonCommutativeMultiply"}], ")"}], "[", 
    RowBox[{"a___", ",", "b_Times", ",", "c___"}], "]"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"Most", "[", "b", "]"}], 
   RowBox[{"ExpandNCM", "[", 
    RowBox[{"h", "[", 
     RowBox[{"a", ",", 
      RowBox[{"Last", "[", "b", "]"}], ",", "c"}], "]"}], 
    "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ExpandNCM", "[", "a_", "]"}], ":=", 
   RowBox[{"ExpandAll", "[", "a", "]"}]}], "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"g", " ", "acts", " ", "on", " ", "coefficients"}], ",", " ", 
    RowBox[{"f", " ", "acts", " ", "on", " ", "NonCM"}]}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"sendNCM", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"h", ":", "Times"}], ")"}], "[", 
     RowBox[{"a___", ",", "b_NonCommutativeMultiply"}], "]"}], ",", "g_", ",",
     "f_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"g", "[", 
    RowBox[{"Times", "[", "a", "]"}], "]"}], 
   RowBox[{"f", "[", "b", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"sendNCM", "[", 
    RowBox[{"b_NonCommutativeMultiply", ",", "g_", ",", "f_"}], "]"}], ":=", 
   RowBox[{"f", "[", "b", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AppToNCM", "[", 
   RowBox[{"exp_", ",", "g_", ",", "f_"}], "]"}], ":=", 
  RowBox[{"Distribute", "[", 
   RowBox[{"sendNCM", "[", 
    RowBox[{
     RowBox[{"ExpandNCM", "[", "exp", "]"}], ",", "g", ",", "f"}], "]"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"takeDag", "[", "exp_", "]"}], ":=", 
  RowBox[{
   RowBox[{"AppToNCM", "[", 
    RowBox[{"exp", ",", "Conjugate", ",", "Reverse"}], "]"}], "/.", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"d", "\[Rule]", "o"}], ",", 
     RowBox[{"o", "\[Rule]", "d"}]}], "}"}]}]}]}], "Code",
 CellChangeTimes->{{3.763770873080701*^9, 3.76377089223626*^9}, {
  3.763770962715602*^9, 3.7637710222362623`*^9}, {3.763771342741963*^9, 
  3.7637713483317065`*^9}, {3.763771473275215*^9, 3.76377153508985*^9}, {
  3.7637716965601974`*^9, 3.763771702279603*^9}, {3.7637718411995115`*^9, 
  3.763771868823224*^9}, {3.7637721869670925`*^9, 3.7637721972300797`*^9}, {
  3.763772328151232*^9, 3.763772328730627*^9}, {3.7637723764962645`*^9, 
  3.7637723767974586`*^9}, {3.7637724071020107`*^9, 3.7637724075587893`*^9}, {
  3.7637738770100594`*^9, 3.7637738802803106`*^9}, {3.7637739283407373`*^9, 
  3.763773930243647*^9}, {3.7637741746558123`*^9, 3.7637741975435605`*^9}, {
  3.763774341539339*^9, 
  3.7637743542992263`*^9}},ExpressionUUID->"261cdb7c-b37c-4cf8-83df-\
58d6b7c43a9d"],

Cell[CellGroupData[{

Cell["check", "Subsubsubsection",
 CellChangeTimes->{{3.763772797081771*^9, 
  3.7637727975612373`*^9}},ExpressionUUID->"ffa9f850-4d35-48b3-a8bf-\
2c8c5deb95e5"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"OrderedQ", "[", 
  RowBox[{"{", 
   RowBox[{"d", ",", "o"}], "}"}], "]"}]], "Input",
 CellChangeTimes->{{3.7637742844520607`*^9, 
  3.7637743361248245`*^9}},ExpressionUUID->"7ba7efba-b186-4d04-b0fc-\
0922d135a63f"],

Cell[BoxData["True"], "Output",
 CellChangeTimes->{{3.7637742923968067`*^9, 
  3.763774337245826*^9}},ExpressionUUID->"f821b3fe-0c6f-41f0-a1c4-\
4092995cd374"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"a", "[", 
  RowBox[{"\[Bullet]", ",", "1"}], "]"}]], "Input",
 CellChangeTimes->{{3.7637742680080523`*^9, 
  3.763774276298896*^9}},ExpressionUUID->"291fbe94-32a2-477e-b355-\
ec50af32f88d"],

Cell[BoxData[
 RowBox[{"a", "[", 
  RowBox[{"\[Bullet]", ",", "1"}], "]"}]], "Output",
 CellChangeTimes->{{3.7637742694282527`*^9, 
  3.763774276739693*^9}},ExpressionUUID->"df424fc7-bd53-43b3-957c-\
644eb4f4597f"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"exp1", "=", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"a", "[", 
       RowBox[{"d", ",", "1", ",", "j", ",", "k"}], "]"}], "**", 
      RowBox[{"a", "[", 
       RowBox[{"o", ",", "3", ",", "i", ",", "j"}], "]"}]}], "+", 
     RowBox[{"a", "[", 
      RowBox[{"d", ",", "2", ",", "i", ",", "o"}], "]"}]}], ")"}], "**", 
   RowBox[{"a", "[", 
    RowBox[{"d", ",", "i", ",", "a", ",", "l"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.763770673031802*^9, 3.763770758553509*^9}, {
  3.7637722584029703`*^9, 3.7637722884388723`*^9}, {3.7637724146745586`*^9, 
  3.763772448507808*^9}, {3.763772547864563*^9, 3.7637725545335054`*^9}, {
  3.7637732272712526`*^9, 
  3.763773245726435*^9}},ExpressionUUID->"7cd8eaa6-df81-4d8a-b135-\
7bfeb2517980"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(", 
   RowBox[{
    RowBox[{"a", "[", 
     RowBox[{"d", ",", "2", ",", "i", ",", "o"}], "]"}], "+", 
    RowBox[{
     RowBox[{"a", "[", 
      RowBox[{"d", ",", "1", ",", "j", ",", "k"}], "]"}], "**", 
     RowBox[{"a", "[", 
      RowBox[{"o", ",", "3", ",", "i", ",", "j"}], "]"}]}]}], ")"}], "**", 
  RowBox[{"a", "[", 
   RowBox[{"d", ",", "i", ",", "a", ",", "l"}], "]"}]}]], "Output",
 CellChangeTimes->{
  3.7637707227752156`*^9, 3.763770760172735*^9, 3.7637722006723924`*^9, 
   3.763772289529934*^9, {3.763772416095172*^9, 3.7637724494353266`*^9}, 
   3.763772554987925*^9, 
   3.7637739356172714`*^9},ExpressionUUID->"06d539db-fe1c-4007-8ef4-\
ab4c3a17d634"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AppToNCM", "[", 
  RowBox[{"exp1", ",", "Identity", ",", "Reverse"}], "]"}]], "Input",
 CellChangeTimes->{{3.763771381012804*^9, 3.7637713838759923`*^9}, {
   3.763771540272252*^9, 3.763771543363485*^9}, {3.763771654812274*^9, 
   3.763771674039299*^9}, 3.763771708003343*^9, {3.7637717520732765`*^9, 
   3.7637717927678604`*^9}, {3.7637722089084425`*^9, 
   3.7637722190608115`*^9}, {3.7637725157877812`*^9, 3.763772528871604*^9}, {
   3.76377382348873*^9, 3.7637738299613924`*^9}, {3.763773911908697*^9, 
   3.763773913801652*^9}},ExpressionUUID->"55d6fc69-fd85-4faf-8aae-\
55715f21379b"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"a", "[", 
    RowBox[{"d", ",", "i", ",", "a", ",", "l"}], "]"}], "**", 
   RowBox[{"a", "[", 
    RowBox[{"d", ",", "2", ",", "i", ",", "o"}], "]"}]}], "+", 
  RowBox[{
   RowBox[{"a", "[", 
    RowBox[{"d", ",", "i", ",", "a", ",", "l"}], "]"}], "**", 
   RowBox[{"a", "[", 
    RowBox[{"o", ",", "3", ",", "i", ",", "j"}], "]"}], "**", 
   RowBox[{"a", "[", 
    RowBox[{"d", ",", "1", ",", "j", ",", "k"}], "]"}]}]}]], "Output",
 CellChangeTimes->{
  3.7637715438080025`*^9, {3.7637716566105905`*^9, 3.763771674483775*^9}, 
   3.7637717086625524`*^9, {3.7637717532006683`*^9, 3.763771793363245*^9}, {
   3.7637722025767365`*^9, 3.763772219458722*^9}, 3.763772291664581*^9, 
   3.7637723389267693`*^9, {3.7637724126163464`*^9, 3.763772438164012*^9}, {
   3.7637725171201677`*^9, 3.7637725566415505`*^9}, 3.763773830284528*^9, {
   3.763773885366727*^9, 
   3.7637739408004055`*^9}},ExpressionUUID->"e43daa7b-8c28-486a-8b7e-\
fe2a2bebeb2c"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Reverse", "[", 
  RowBox[{"p1", "**", "p2", "**", "p3"}], "]"}]], "Input",
 CellChangeTimes->{{3.7637718139144635`*^9, 
  3.7637718203680124`*^9}},ExpressionUUID->"0708eac9-61c7-4edc-92ef-\
94b063ac71d6"],

Cell[BoxData[
 RowBox[{"p3", "**", "p2", "**", "p1"}]], "Output",
 CellChangeTimes->{
  3.763771820853718*^9},ExpressionUUID->"bf5c6b9a-c153-4c8a-9791-\
f968e1b67ccd"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Head", "[", "exp1", "]"}]], "Input",
 CellChangeTimes->{{3.7637723123841696`*^9, 
  3.7637723166504574`*^9}},ExpressionUUID->"20df9110-dff1-4a06-92ea-\
e641404fda40"],

Cell[BoxData["NonCommutativeMultiply"], "Output",
 CellChangeTimes->{
  3.763772316998526*^9},ExpressionUUID->"c10fb15f-45aa-448f-8a2a-\
8e4535c81be0"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Head", "[", 
  RowBox[{
   RowBox[{"a", "**", "b"}], "+", 
   RowBox[{"c", "**", "d"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.7637726286426907`*^9, 
  3.7637726387500005`*^9}},ExpressionUUID->"2bf655b4-094d-48b4-9ccf-\
73fd513a0604"],

Cell[BoxData["Plus"], "Output",
 CellChangeTimes->{{3.7637726357670574`*^9, 
  3.7637726391559176`*^9}},ExpressionUUID->"46a7e792-cd7d-4bd1-9eb4-\
ce2f7da1164e"]
}, Open  ]]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Bosonization dict", "Subsection",
 CellChangeTimes->{{3.7637728036368217`*^9, 
  3.763772808312707*^9}},ExpressionUUID->"bdf0b498-514d-4452-8435-\
e10bf4169263"],

Cell[TextData[{
 "We use a[_,_,_] to represent fermion operator \[Psi], [l/r,s/x,d/o] ",
 Cell[BoxData[
  FormBox[
   RowBox[{"\[Rule]", " "}], TraditionalForm]],
  FormatType->"TraditionalForm",ExpressionUUID->
  "3cbeb641-50a3-4784-9d19-ac9f459677e6"],
 "L/R, \[UpArrow]/\[DownArrow], \[Dagger]/-"
}], "TextIndent",
 CellChangeTimes->{{3.763772835548565*^9, 
  3.7637730158691864`*^9}},ExpressionUUID->"fe216450-10da-49b3-a9e6-\
87c26e94031e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"p", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"a", "[", 
      RowBox[{"l", ",", "s", ",", "o"}], "]"}], ",", 
     RowBox[{"a", "[", 
      RowBox[{"l", ",", "x", ",", "o"}], "]"}], ",", 
     RowBox[{"a", "[", 
      RowBox[{"r", ",", "s", ",", "o"}], "]"}], ",", 
     RowBox[{"a", "[", 
      RowBox[{"r", ",", "x", ",", "o"}], "]"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pd", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"a", "[", 
      RowBox[{"l", ",", "s", ",", "d"}], "]"}], ",", 
     RowBox[{"a", "[", 
      RowBox[{"l", ",", "x", ",", "d"}], "]"}], ",", 
     RowBox[{"a", "[", 
      RowBox[{"r", ",", "s", ",", "d"}], "]"}], ",", 
     RowBox[{"a", "[", 
      RowBox[{"r", ",", "x", ",", "d"}], "]"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pl", "=", 
   RowBox[{"p", "\[LeftDoubleBracket]", 
    RowBox[{"1", ";;", "2"}], "\[RightDoubleBracket]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pr", "=", 
   RowBox[{"p", "\[LeftDoubleBracket]", 
    RowBox[{"3", ";;", "4"}], "\[RightDoubleBracket]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pld", "=", 
   RowBox[{"pd", "\[LeftDoubleBracket]", 
    RowBox[{"1", ";;", "2"}], "\[RightDoubleBracket]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"prd", "=", 
   RowBox[{"pd", "\[LeftDoubleBracket]", 
    RowBox[{"3", ";;", "4"}], "\[RightDoubleBracket]"}]}], ";"}]}], "Code",
 CellChangeTimes->{{3.7637730904462547`*^9, 
  3.763773094581216*^9}},ExpressionUUID->"1aecc2d9-9734-4c3e-8205-\
62fb26b72b0c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"term", "[", 
   RowBox[{"l_", ",", "v_", ",", "r_"}], "]"}], ":=", 
  RowBox[{"Sum", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"v", "\[LeftDoubleBracket]", 
      RowBox[{"i", ",", "j"}], "\[RightDoubleBracket]"}], 
     RowBox[{
      RowBox[{"l", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], "**", 
      RowBox[{"r", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}]}]}],
     ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", 
      RowBox[{"Length", "@", "v"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"j", ",", 
      RowBox[{"Length", "@", "v"}]}], "}"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"takeDag", "[", "exp_", "]"}], ":=", 
  RowBox[{
   RowBox[{"AppToNCM", "[", 
    RowBox[{"exp", ",", "Conjugate", ",", "Reverse"}], "]"}], "/.", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"d", "\[Rule]", "o"}], ",", 
     RowBox[{"o", "\[Rule]", "d"}]}], "}"}]}]}]}], "Code",
 CellChangeTimes->{
  3.7637731089367886`*^9, {3.7637732049373226`*^9, 3.763773213025364*^9}, {
   3.7637732702588053`*^9, 3.7637732788861003`*^9}, {3.76377334366269*^9, 
   3.763773385092787*^9}},ExpressionUUID->"507a85f6-8c1a-4f13-8748-\
c0b941dac80d"],

Cell["\<\
because of the point split, we don\[CloseCurlyQuote]t have delta function, we \
would like to convert the operator expression in the order of their labels, \
namely,\
\>", "TextIndent",
 CellChangeTimes->{{3.7637733968059855`*^9, 
  3.7637735097841434`*^9}},ExpressionUUID->"dfc7c9f0-e6dd-4d51-9de3-\
98441bf7c8fc"],

Cell[BoxData[
 FormBox[
  RowBox[{
   SubsuperscriptBox["\[Psi]", 
    RowBox[{"L", "\[UpArrow]"}], 
    RowBox[{"d", "/", "o"}]], 
   SubsuperscriptBox["\[Psi]", 
    RowBox[{"L", "\[DownArrow]"}], 
    RowBox[{"d", "/", "o"}]], 
   SubsuperscriptBox["\[Psi]", 
    RowBox[{"R", "\[UpArrow]"}], 
    RowBox[{"d", "/", "o"}]], 
   SubsuperscriptBox["\[Psi]", 
    RowBox[{"R", "\[DownArrow]"}], 
    RowBox[{"d", "/", "o"}]]}], TraditionalForm]], "DisplayFormulaNumbered",
 CellChangeTimes->{{3.763773521680318*^9, 
  3.763773550011811*^9}},ExpressionUUID->"5437fefd-68cc-4d02-8005-\
d2ff7a58afaf"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"NOBosonization", "[", "0", "]"}], "=", "0"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"NOBosonization", "[", 
     RowBox[{"left___", ",", 
      RowBox[{"a_", "[", "k1__", "]"}], ",", 
      RowBox[{"b_", "[", "k2__", "]"}], ",", "right___"}], "]"}], "/;", 
    RowBox[{"!", 
     RowBox[{"OrderedQ", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", "k1", "}"}], ",", 
        RowBox[{"{", "k2", "}"}]}], "}"}], "]"}]}]}], ":=", 
   RowBox[{"-", 
    RowBox[{"NOBosonization", "[", 
     RowBox[{"left", ",", 
      RowBox[{"b", "[", "k2", "]"}], ",", 
      RowBox[{"a", "[", "k1", "]"}], ",", "right"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"NOrderBosonization", "[", "exp_", "]"}], ":=", 
   RowBox[{
    RowBox[{"AppToNCM", "[", 
     RowBox[{"exp", ",", "Identity", ",", "NOBosonization"}], "]"}], "/.", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"NonCommutativeMultiply", "[", "ss__", "]"}], "\[RuleDelayed]", 
      " ", "ss"}], "}"}]}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", "Representation", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"rules", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"a", "[", 
        RowBox[{"l", ",", "s", ",", "d"}], "]"}], "\[Rule]", 
       "\"\<\!\(\*SubsuperscriptBox[\(\[Psi]\), \(\(L\)\(\[UpArrow]\)\), \(\
\[Dagger]\)]\)\>\""}], ",", 
      RowBox[{
       RowBox[{"a", "[", 
        RowBox[{"l", ",", "s", ",", "o"}], "]"}], "\[Rule]", 
       "\"\<\!\(\*SubscriptBox[\(\[Psi]\), \(\(L\)\(\[UpArrow]\)\)]\)\>\""}], 
      ",", 
      RowBox[{
       RowBox[{"a", "[", 
        RowBox[{"l", ",", "x", ",", "d"}], "]"}], "\[Rule]", 
       "\"\<\!\(\*SubsuperscriptBox[\(\[Psi]\), \(\(L\)\(\[DownArrow]\)\), \(\
\[Dagger]\)]\)\>\""}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"a", "[", 
        RowBox[{"l", ",", "x", ",", "o"}], "]"}], "\[Rule]", 
       "\"\<\!\(\*SubscriptBox[\(\[Psi]\), \
\(\(L\)\(\[DownArrow]\)\)]\)\>\""}], ",", 
      RowBox[{
       RowBox[{"a", "[", 
        RowBox[{"r", ",", "s", ",", "d"}], "]"}], "\[Rule]", 
       "\"\<\!\(\*SubsuperscriptBox[\(\[Psi]\), \(\(R\)\(\[UpArrow]\)\), \(\
\[Dagger]\)]\)\>\""}], ",", 
      RowBox[{
       RowBox[{"a", "[", 
        RowBox[{"r", ",", "s", ",", "o"}], "]"}], "\[Rule]", 
       "\"\<\!\(\*SubscriptBox[\(\[Psi]\), \(\(R\)\(\[UpArrow]\)\)]\)\>\""}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"a", "[", 
        RowBox[{"r", ",", "x", ",", "d"}], "]"}], "\[Rule]", 
       "\"\<\!\(\*SubsuperscriptBox[\(\[Psi]\), \(\(R\)\(\[DownArrow]\)\), \(\
\[Dagger]\)]\)\>\""}], ",", 
      RowBox[{
       RowBox[{"a", "[", 
        RowBox[{"r", ",", "x", ",", "o"}], "]"}], "\[Rule]", 
       "\"\<\!\(\*SubscriptBox[\(\[Psi]\), \
\(\(R\)\(\[DownArrow]\)\)]\)\>\""}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"a", "[", "d", "]"}], "\[Rule]", 
       "\"\<\!\(\*SuperscriptBox[\(\[Psi]\), \(\[Dagger]\)]\)\>\""}], ",", 
      RowBox[{
       RowBox[{"a", "[", "o", "]"}], "\[Rule]", "\"\<\[Psi]\>\""}]}], "}"}]}],
    ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"represent", "[", "exp_", "]"}], ":=", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{"exp", "/.", 
     RowBox[{
      RowBox[{"NOBosonization", "[", "a__", "]"}], "\[RuleDelayed]", 
      RowBox[{"NO", "[", "a", "]"}]}]}], ")"}], "/.", "rules"}]}]}], "Code",
 CellChangeTimes->{{3.7637735636677876`*^9, 3.7637736027641954`*^9}, {
   3.763773635827766*^9, 3.763773716401232*^9}, 3.7637740067160664`*^9, {
   3.7637740510235395`*^9, 3.763774062505839*^9}, {3.7637740946647844`*^9, 
   3.7637741258593535`*^9}},ExpressionUUID->"25bfd6d9-431c-4700-867e-\
654ccb1a523e"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"NOrderBosonization", "[", 
   RowBox[{
    RowBox[{"term", "[", 
     RowBox[{"pd", ",", 
      RowBox[{"\[Sigma]s", "[", 
       RowBox[{"1", ",", "2"}], "]"}], ",", "p"}], "]"}], "**", 
    RowBox[{"term", "[", 
     RowBox[{"pd", ",", 
      RowBox[{"\[Sigma]s", "[", 
       RowBox[{"2", ",", "3"}], "]"}], ",", "p"}], "]"}]}], "]"}], "//", 
  "represent"}]], "Input",
 CellChangeTimes->{{3.7637737218317003`*^9, 3.7637737320563097`*^9}, {
  3.7637739896168113`*^9, 3.763774029219864*^9}, {3.7637741022754235`*^9, 
  3.7637741055217624`*^9}},ExpressionUUID->"6c6387db-4b77-44bb-9835-\
191f6f5078c5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"NO", "[", 
   RowBox[{"\<\"\\!\\(\\*SubscriptBox[\\(\[Psi]\\), \\(\\(L\\)\\(\[DownArrow]\
\\)\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubscriptBox[\\(\[Psi]\\), \
\\(\\(L\\)\\(\[DownArrow]\\)\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubsuperscriptBox[\\(\[Psi]\\), \
\\(\\(R\\)\\(\[UpArrow]\\)\\), \\(\[Dagger]\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubsuperscriptBox[\\(\[Psi]\\), \\(\\(R\\)\\(\
\[DownArrow]\\)\\), \\(\[Dagger]\\)]\\)\"\>"}], "]"}], "-", 
  RowBox[{"NO", "[", 
   RowBox[{"\<\"\\!\\(\\*SubscriptBox[\\(\[Psi]\\), \
\\(\\(L\\)\\(\[UpArrow]\\)\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubscriptBox[\\(\[Psi]\\), \
\\(\\(L\\)\\(\[DownArrow]\\)\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubsuperscriptBox[\\(\[Psi]\\), \\(\\(R\\)\\(\
\[DownArrow]\\)\\), \\(\[Dagger]\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubsuperscriptBox[\\(\[Psi]\\), \\(\\(R\\)\\(\
\[DownArrow]\\)\\), \\(\[Dagger]\\)]\\)\"\>"}], "]"}], "+", 
  RowBox[{"NO", "[", 
   RowBox[{"\<\"\\!\\(\\*SubscriptBox[\\(\[Psi]\\), \
\\(\\(L\\)\\(\[UpArrow]\\)\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubscriptBox[\\(\[Psi]\\), \
\\(\\(L\\)\\(\[DownArrow]\\)\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubsuperscriptBox[\\(\[Psi]\\), \
\\(\\(R\\)\\(\[UpArrow]\\)\\), \\(\[Dagger]\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubsuperscriptBox[\\(\[Psi]\\), \
\\(\\(R\\)\\(\[UpArrow]\\)\\), \\(\[Dagger]\\)]\\)\"\>"}], "]"}], "-", 
  RowBox[{"NO", "[", 
   RowBox[{"\<\"\\!\\(\\*SubscriptBox[\\(\[Psi]\\), \
\\(\\(L\\)\\(\[UpArrow]\\)\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubscriptBox[\\(\[Psi]\\), \
\\(\\(L\\)\\(\[UpArrow]\\)\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubsuperscriptBox[\\(\[Psi]\\), \
\\(\\(R\\)\\(\[UpArrow]\\)\\), \\(\[Dagger]\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubsuperscriptBox[\\(\[Psi]\\), \\(\\(R\\)\\(\
\[DownArrow]\\)\\), \\(\[Dagger]\\)]\\)\"\>"}], "]"}], "-", 
  RowBox[{"NO", "[", 
   RowBox[{"\<\"\\!\\(\\*SubscriptBox[\\(\[Psi]\\), \
\\(\\(L\\)\\(\[UpArrow]\\)\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubsuperscriptBox[\\(\[Psi]\\), \\(\\(L\\)\\(\
\[DownArrow]\\)\\), \\(\[Dagger]\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubsuperscriptBox[\\(\[Psi]\\), \\(\\(R\\)\\(\
\[DownArrow]\\)\\), \\(\[Dagger]\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubscriptBox[\\(\[Psi]\\), \
\\(\\(R\\)\\(\[DownArrow]\\)\\)]\\)\"\>"}], "]"}], "-", 
  RowBox[{"NO", "[", 
   RowBox[{"\<\"\\!\\(\\*SubscriptBox[\\(\[Psi]\\), \
\\(\\(L\\)\\(\[UpArrow]\\)\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubsuperscriptBox[\\(\[Psi]\\), \\(\\(L\\)\\(\
\[DownArrow]\\)\\), \\(\[Dagger]\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubsuperscriptBox[\\(\[Psi]\\), \
\\(\\(R\\)\\(\[UpArrow]\\)\\), \\(\[Dagger]\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubscriptBox[\\(\[Psi]\\), \
\\(\\(R\\)\\(\[UpArrow]\\)\\)]\\)\"\>"}], "]"}], "+", 
  RowBox[{"NO", "[", 
   RowBox[{"\<\"\\!\\(\\*SubsuperscriptBox[\\(\[Psi]\\), \\(\\(L\\)\\(\
\[DownArrow]\\)\\), \\(\[Dagger]\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubscriptBox[\\(\[Psi]\\), \
\\(\\(L\\)\\(\[DownArrow]\\)\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubscriptBox[\\(\[Psi]\\), \
\\(\\(R\\)\\(\[UpArrow]\\)\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubsuperscriptBox[\\(\[Psi]\\), \\(\\(R\\)\\(\
\[DownArrow]\\)\\), \\(\[Dagger]\\)]\\)\"\>"}], "]"}], "-", 
  RowBox[{"NO", "[", 
   RowBox[{"\<\"\\!\\(\\*SubsuperscriptBox[\\(\[Psi]\\), \\(\\(L\\)\\(\
\[DownArrow]\\)\\), \\(\[Dagger]\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubscriptBox[\\(\[Psi]\\), \
\\(\\(L\\)\\(\[DownArrow]\\)\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubsuperscriptBox[\\(\[Psi]\\), \
\\(\\(R\\)\\(\[UpArrow]\\)\\), \\(\[Dagger]\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubscriptBox[\\(\[Psi]\\), \
\\(\\(R\\)\\(\[DownArrow]\\)\\)]\\)\"\>"}], "]"}], "+", 
  RowBox[{"NO", "[", 
   RowBox[{"\<\"\\!\\(\\*SubsuperscriptBox[\\(\[Psi]\\), \\(\\(L\\)\\(\
\[DownArrow]\\)\\), \\(\[Dagger]\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubsuperscriptBox[\\(\[Psi]\\), \\(\\(L\\)\\(\
\[DownArrow]\\)\\), \\(\[Dagger]\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubscriptBox[\\(\[Psi]\\), \
\\(\\(R\\)\\(\[UpArrow]\\)\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubscriptBox[\\(\[Psi]\\), \
\\(\\(R\\)\\(\[DownArrow]\\)\\)]\\)\"\>"}], "]"}], "+", 
  RowBox[{"NO", "[", 
   RowBox[{"\<\"\\!\\(\\*SubsuperscriptBox[\\(\[Psi]\\), \\(\\(L\\)\\(\
\[UpArrow]\\)\\), \\(\[Dagger]\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubscriptBox[\\(\[Psi]\\), \
\\(\\(L\\)\\(\[DownArrow]\\)\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubsuperscriptBox[\\(\[Psi]\\), \\(\\(R\\)\\(\
\[DownArrow]\\)\\), \\(\[Dagger]\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubscriptBox[\\(\[Psi]\\), \
\\(\\(R\\)\\(\[DownArrow]\\)\\)]\\)\"\>"}], "]"}], "+", 
  RowBox[{"NO", "[", 
   RowBox[{"\<\"\\!\\(\\*SubsuperscriptBox[\\(\[Psi]\\), \\(\\(L\\)\\(\
\[UpArrow]\\)\\), \\(\[Dagger]\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubscriptBox[\\(\[Psi]\\), \
\\(\\(L\\)\\(\[DownArrow]\\)\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubsuperscriptBox[\\(\[Psi]\\), \
\\(\\(R\\)\\(\[UpArrow]\\)\\), \\(\[Dagger]\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubscriptBox[\\(\[Psi]\\), \
\\(\\(R\\)\\(\[UpArrow]\\)\\)]\\)\"\>"}], "]"}], "+", 
  RowBox[{"NO", "[", 
   RowBox[{"\<\"\\!\\(\\*SubsuperscriptBox[\\(\[Psi]\\), \\(\\(L\\)\\(\
\[UpArrow]\\)\\), \\(\[Dagger]\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubscriptBox[\\(\[Psi]\\), \
\\(\\(L\\)\\(\[UpArrow]\\)\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubscriptBox[\\(\[Psi]\\), \
\\(\\(R\\)\\(\[UpArrow]\\)\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubsuperscriptBox[\\(\[Psi]\\), \\(\\(R\\)\\(\
\[DownArrow]\\)\\), \\(\[Dagger]\\)]\\)\"\>"}], "]"}], "-", 
  RowBox[{"NO", "[", 
   RowBox[{"\<\"\\!\\(\\*SubsuperscriptBox[\\(\[Psi]\\), \\(\\(L\\)\\(\
\[UpArrow]\\)\\), \\(\[Dagger]\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubscriptBox[\\(\[Psi]\\), \
\\(\\(L\\)\\(\[UpArrow]\\)\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubsuperscriptBox[\\(\[Psi]\\), \
\\(\\(R\\)\\(\[UpArrow]\\)\\), \\(\[Dagger]\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubscriptBox[\\(\[Psi]\\), \
\\(\\(R\\)\\(\[DownArrow]\\)\\)]\\)\"\>"}], "]"}], "-", 
  RowBox[{"NO", "[", 
   RowBox[{"\<\"\\!\\(\\*SubsuperscriptBox[\\(\[Psi]\\), \\(\\(L\\)\\(\
\[UpArrow]\\)\\), \\(\[Dagger]\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubsuperscriptBox[\\(\[Psi]\\), \\(\\(L\\)\\(\
\[DownArrow]\\)\\), \\(\[Dagger]\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubscriptBox[\\(\[Psi]\\), \
\\(\\(R\\)\\(\[DownArrow]\\)\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubscriptBox[\\(\[Psi]\\), \
\\(\\(R\\)\\(\[DownArrow]\\)\\)]\\)\"\>"}], "]"}], "+", 
  RowBox[{"NO", "[", 
   RowBox[{"\<\"\\!\\(\\*SubsuperscriptBox[\\(\[Psi]\\), \\(\\(L\\)\\(\
\[UpArrow]\\)\\), \\(\[Dagger]\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubsuperscriptBox[\\(\[Psi]\\), \\(\\(L\\)\\(\
\[DownArrow]\\)\\), \\(\[Dagger]\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubscriptBox[\\(\[Psi]\\), \
\\(\\(R\\)\\(\[UpArrow]\\)\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubscriptBox[\\(\[Psi]\\), \
\\(\\(R\\)\\(\[UpArrow]\\)\\)]\\)\"\>"}], "]"}], "-", 
  RowBox[{"NO", "[", 
   RowBox[{"\<\"\\!\\(\\*SubsuperscriptBox[\\(\[Psi]\\), \\(\\(L\\)\\(\
\[UpArrow]\\)\\), \\(\[Dagger]\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubsuperscriptBox[\\(\[Psi]\\), \
\\(\\(L\\)\\(\[UpArrow]\\)\\), \\(\[Dagger]\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubscriptBox[\\(\[Psi]\\), \
\\(\\(R\\)\\(\[UpArrow]\\)\\)]\\)\"\>", 
    ",", "\<\"\\!\\(\\*SubscriptBox[\\(\[Psi]\\), \
\\(\\(R\\)\\(\[DownArrow]\\)\\)]\\)\"\>"}], "]"}]}]], "Output",
 CellChangeTimes->{
  3.763773733999113*^9, {3.7637740003231688`*^9, 3.763774029769415*^9}, {
   3.76377410599248*^9, 
   3.7637741274041986`*^9}},ExpressionUUID->"f39e50ba-0d44-4f72-bdf9-\
13a8b3af7444"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Fermion/Boson Normal Ordering", "Subsection",
 CellChangeTimes->{{3.7637744741595516`*^9, 3.763774489815667*^9}, {
  3.7637753779099054`*^9, 
  3.763775378141286*^9}},ExpressionUUID->"bfe1e2d7-08cb-4120-be64-\
04628fb1da3a"],

Cell[BoxData[
 RowBox[{"(*", "\n", 
  RowBox[{
   RowBox[{"NOrderB", "::", "usage"}], "=", 
   RowBox[{
    RowBox[{
    "\"\<[NCM] gives boson normal ordering, a[d,...] a[o,...] reps \
creation/annihilation\>\"", "\n", 
     RowBox[{"NOrderF", "::", "usage"}]}], "=", 
    RowBox[{
     RowBox[{
     "\"\<[NCM] gives fermion normal ordering, c[d,...] c[o,...] reps \
creation/annihilation\>\"", "\n", 
      RowBox[{"WickCon", "::", "usage"}]}], "=", 
     RowBox[{
      RowBox[{"\"\<[exp,NOrderB/F] wick contraction\>\"", "\n", 
       RowBox[{"norderB", "::", "usage"}]}], "=", 
      RowBox[{
       RowBox[{"\"\<boson normal ordering\>\"", "\n", 
        RowBox[{"norderF", "::", "usage"}]}], "=", 
       "\"\<boson normal ordering\>\""}]}]}]}]}], "\n", "*)"}]], "Input",Expre\
ssionUUID->"974dde74-6567-4736-9632-5b1c770d2d3c"],

Cell["\<\
we would like to move all the creation operators to the left and annihilation \
operators to the right, the operators are represented as,\
\>", "TextIndent",
 CellChangeTimes->{{3.763775326149289*^9, 
  3.763775396498155*^9}},ExpressionUUID->"a1ef068c-056c-4597-a874-\
5a32e00fbe94"],

Cell[BoxData[
 FormBox[
  RowBox[{
   SubsuperscriptBox["\[Psi]", 
    RowBox[{"\[Alpha]\[Beta]\[Gamma]\[Delta]", "..."}], 
    RowBox[{"\[Dagger]", "/", "o"}]], "=", 
   RowBox[{"a", "[", 
    RowBox[{
     RowBox[{"d", "/", "o"}], ",", "\[Alpha]", ",", "\[Beta]", ",", 
     "\[Gamma]", ",", "\[Delta]", ",", "..."}], "]"}]}], 
  TraditionalForm]], "DisplayFormulaNumbered",
 CellChangeTimes->{{3.763775398669347*^9, 
  3.7637754499092293`*^9}},ExpressionUUID->"1bcec8e2-7ded-4015-8239-\
46dc77187852"],

Cell[BoxData[{
 FormBox[
  RowBox[{
   RowBox[{
    RowBox[{"[", 
     RowBox[{
      SubscriptBox["a", "k1"], ",", 
      SubsuperscriptBox["a", "k2", "\[Dagger]"]}], "]"}], "=", 
    RowBox[{
     RowBox[{
      SubscriptBox["\[Delta]", 
       RowBox[{"k1", ",", "k2"}]], " ", "\[Implies]", " ", 
      RowBox[{
       SubscriptBox["a", "k1"], 
       SubsuperscriptBox["a", "k1", "\[Dagger]"]}]}], "=", 
     RowBox[{"1", "+", 
      RowBox[{
       SubsuperscriptBox["a", "k1", "\[Dagger]"], 
       SubscriptBox["a", "k1"]}]}]}]}], ";", "   ", 
   RowBox[{
    RowBox[{
     SubscriptBox["a", "k1"], 
     SubsuperscriptBox["a", "k2", "\[Dagger]"]}], "=", 
    RowBox[{
     SubsuperscriptBox["a", "k2", "\[Dagger]"], 
     SubscriptBox["a", "k1"]}]}]}], TraditionalForm], "\[IndentingNewLine]", 
 FormBox[
  RowBox[{
   RowBox[{
    RowBox[{
     SubscriptBox["a", "k1"], 
     SubscriptBox["a", "k2"]}], "=", 
    RowBox[{
     SubscriptBox["a", "k2"], 
     SubscriptBox["a", "k1"]}]}], ";", "   ", 
   RowBox[{
    RowBox[{
     SubsuperscriptBox["a", "k1", "\[Dagger]"], 
     SubsuperscriptBox["a", "k2", "\[Dagger]"]}], "=", 
    RowBox[{
     SubsuperscriptBox["a", "k2", "\[Dagger]"], 
     SubsuperscriptBox["a", "k1", "\[Dagger]"]}]}]}], 
  TraditionalForm], "\[IndentingNewLine]", 
 FormBox[
  RowBox[{
   RowBox[{
    SubsuperscriptBox["a", "k1", "\[Dagger]"], 
    SubscriptBox["a", "k1"]}], "=", 
   SubscriptBox["n", "k1"]}], TraditionalForm]}], "DisplayFormulaNumbered",
 CellChangeTimes->{{3.7637781089390836`*^9, 3.763778205842098*^9}, {
  3.763778252030512*^9, 
  3.763778283657236*^9}},ExpressionUUID->"61cd1c9f-c49e-4966-a7e1-\
b8e28436ba06"],

Cell[BoxData[{
 RowBox[{"ClearAll", "[", 
  RowBox[{"norderB", ",", "NOrderB"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"norderB", "[", "]"}], "=", "1"}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Commutation", " ", 
     RowBox[{"relation", ":", 
      RowBox[{"[", 
       RowBox[{
        RowBox[{"a", 
         RowBox[{"(", "k1", ")"}]}], ",", 
        RowBox[{"a\[Dagger]", 
         RowBox[{"(", "k2", ")"}]}]}], "]"}]}]}], "=", 
    RowBox[{"\[Delta]", 
     RowBox[{"(", 
      RowBox[{"k1", ",", "k2"}], ")"}]}]}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"norderB", "[", 
     RowBox[{"left___", ",", 
      RowBox[{"a", "[", 
       RowBox[{"o", ",", "k1__"}], "]"}], ",", 
      RowBox[{"a", "[", 
       RowBox[{"d", ",", "k2__"}], "]"}], ",", "right___"}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"norderB", "[", 
      RowBox[{"left", ",", 
       RowBox[{"a", "[", 
        RowBox[{"d", ",", "k2"}], "]"}], ",", 
       RowBox[{"a", "[", 
        RowBox[{"o", ",", "k1"}], "]"}], ",", "right"}], "]"}], "+", 
     RowBox[{
      RowBox[{"Times", "@@", 
       RowBox[{"MapThread", "[", 
        RowBox[{"\[Delta]", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", "k1", "}"}], ",", 
           RowBox[{"{", "k2", "}"}]}], "}"}]}], "]"}]}], 
      RowBox[{"norderB", "[", 
       RowBox[{"left", ",", "right"}], "]"}]}]}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Commutation", " ", 
     RowBox[{"relations", ":", 
      RowBox[{"[", 
       RowBox[{
        RowBox[{"a", 
         RowBox[{"(", "k1", ")"}]}], ",", 
        RowBox[{"a", 
         RowBox[{"(", "k2", ")"}]}]}], "]"}]}]}], "=", 
    RowBox[{
     RowBox[{"[", 
      RowBox[{
       RowBox[{"a\[Dagger]", 
        RowBox[{"(", "k1", ")"}]}], ",", 
       RowBox[{"a\[Dagger]", 
        RowBox[{"(", "k2", ")"}]}]}], "]"}], "=", "0"}]}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"norderB", "[", 
     RowBox[{"left___", ",", 
      RowBox[{"a", "[", 
       RowBox[{"o", ",", "k1__"}], "]"}], ",", 
      RowBox[{"a", "[", 
       RowBox[{"o", ",", "k2__"}], "]"}], ",", "right___"}], "]"}], "/;", 
    RowBox[{"!", 
     RowBox[{"OrderedQ", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", "k1", "}"}], ",", 
        RowBox[{"{", "k2", "}"}]}], "}"}], "]"}]}]}], ":=", 
   RowBox[{"norderB", "[", 
    RowBox[{"left", ",", 
     RowBox[{"a", "[", 
      RowBox[{"o", ",", "k2"}], "]"}], ",", 
     RowBox[{"a", "[", 
      RowBox[{"o", ",", "k1"}], "]"}], ",", "right"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"norderB", "[", 
      RowBox[{"left___", ",", 
       RowBox[{"a", "[", 
        RowBox[{"d", ",", "k1__"}], "]"}], ",", 
       RowBox[{"a", "[", 
        RowBox[{"d", ",", "k2__"}], "]"}], ",", "right___"}], "]"}], "/;", 
     RowBox[{"!", 
      RowBox[{"OrderedQ", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", "k1", "}"}], ",", 
         RowBox[{"{", "k2", "}"}]}], "}"}], "]"}]}]}], ":=", 
    RowBox[{"norderB", "[", 
     RowBox[{"left", ",", 
      RowBox[{"a", "[", 
       RowBox[{"d", ",", "k2"}], "]"}], ",", 
      RowBox[{"a", "[", 
       RowBox[{"d", ",", "k1"}], "]"}], ",", "right"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NOrderB", "[", "exp_", "]"}], ":=", 
  RowBox[{
   RowBox[{"AppToNCM", "[", 
    RowBox[{"exp", ",", "Identity", ",", "norderB"}], "]"}], "/.", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"NonCommutativeMultiply", "[", "ss__", "]"}], "\[RuleDelayed]", 
     " ", "ss"}], "}"}]}]}]}], "Code",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQAWIQXTOn/d8VrjeOdTZl/0G0ovYS+atAOoyJVRFEM8Yf
UgXROWpX7EH05uW9riA647WVG4hOs5oXAKJZOLfGg+hHnf6zQXSIxJI5IHr/
HM2FIHpOWwGYZrJMPweiLyR23ATRz1cqPgPRBr0z3oLolc/Tf4JoS9mjDNeA
9ItdLYIgekLNFikQPf91gjyIfv7jF5g+9JhNBUTrvVbWANFCYscNQPSsL3pG
IPpRi4w5iF7wqN0SRD91zbEH0al/C5xA9L77Qokg+teveDC98aam33UgvVap
wR9E9zj/qgXRVzbmNYBov/+mv0D0HfEiMA0AgxKiGg==
  "],ExpressionUUID->"2030d471-0a4b-49ee-8fb9-4fa8ff550681"],

Cell[BoxData[{
 FormBox[
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      SubscriptBox["a", "k1"], ",", 
      SubsuperscriptBox["a", "k2", "\[Dagger]"]}], "}"}], "=", 
    RowBox[{
     RowBox[{
      SubscriptBox["\[Delta]", 
       RowBox[{"k1", ",", "k2"}]], " ", "\[Implies]", " ", 
      RowBox[{
       SubscriptBox["a", "k1"], 
       SubsuperscriptBox["a", "k2", "\[Dagger]"]}]}], "=", 
     RowBox[{
      SubscriptBox["\[Delta]", 
       RowBox[{"k1", ",", "k2"}]], "-", 
      RowBox[{
       SubsuperscriptBox["a", "k2", "\[Dagger]"], 
       SubscriptBox["a", "k1"]}]}]}]}], ";", "   ", 
   RowBox[{
    RowBox[{
     SubscriptBox["a", "k1"], 
     SubsuperscriptBox["a", "k2", "\[Dagger]"]}], "=", 
    RowBox[{
     RowBox[{"-", 
      SubsuperscriptBox["a", "k2", "\[Dagger]"]}], 
     SubscriptBox["a", "k1"]}]}]}], TraditionalForm], "\[IndentingNewLine]", 
 FormBox[
  RowBox[{
   RowBox[{
    RowBox[{
     SubscriptBox["a", "k1"], 
     SubscriptBox["a", "k2"]}], "=", 
    RowBox[{
     RowBox[{"-", 
      SubscriptBox["a", "k2"]}], 
     SubscriptBox["a", "k1"]}]}], ";", "   ", 
   RowBox[{
    RowBox[{
     SubsuperscriptBox["a", "k1", "\[Dagger]"], 
     SubsuperscriptBox["a", "k2", "\[Dagger]"]}], "=", 
    RowBox[{
     RowBox[{"-", 
      SubsuperscriptBox["a", "k2", "\[Dagger]"]}], 
     SubsuperscriptBox["a", "k1", "\[Dagger]"]}]}]}], 
  TraditionalForm], "\[IndentingNewLine]", 
 FormBox[
  RowBox[{
   RowBox[{
    SubsuperscriptBox["a", "k1", "\[Dagger]"], 
    SubscriptBox["a", "k1"]}], "=", 
   SubscriptBox["n", "k1"]}], TraditionalForm]}], "DisplayFormulaNumbered",
 CellChangeTimes->{{3.7637781089390836`*^9, 3.763778205842098*^9}, {
  3.763778252030512*^9, 3.763778283657236*^9}, {3.7637783231974344`*^9, 
  3.763778339649623*^9}, {3.763780623901943*^9, 
  3.7637806322436047`*^9}},ExpressionUUID->"959b0d7a-3009-41d5-8f45-\
985351b0d70e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Now", " ", "for", " ", 
    RowBox[{"fermion", "!!"}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"ClearAll", "[", 
    RowBox[{"norderF", ",", "NOrderF"}], "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"norderF", "[", "]"}], "=", "1"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Commutation", " ", 
      RowBox[{"relation", ":", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"c", 
          RowBox[{"(", "k1", ")"}]}], ",", 
         RowBox[{"c\[Dagger]", 
          RowBox[{"(", "k2", ")"}]}]}], "}"}]}]}], "=", 
     RowBox[{"\[Delta]", 
      RowBox[{"(", 
       RowBox[{"k1", ",", "k2"}], ")"}]}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"norderF", "[", 
      RowBox[{"left___", ",", 
       RowBox[{"c", "[", 
        RowBox[{"o", ",", "k1__"}], "]"}], ",", 
       RowBox[{"c", "[", 
        RowBox[{"d", ",", "k2__"}], "]"}], ",", "right___"}], "]"}], ":=", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"-", 
       RowBox[{"norderF", "[", 
        RowBox[{"left", ",", 
         RowBox[{"c", "[", 
          RowBox[{"d", ",", "k2"}], "]"}], ",", 
         RowBox[{"c", "[", 
          RowBox[{"o", ",", "k1"}], "]"}], ",", "right"}], "]"}]}], "+", 
      RowBox[{
       RowBox[{"Times", "@@", 
        RowBox[{"MapThread", "[", 
         RowBox[{"\[Delta]", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", "k1", "}"}], ",", 
            RowBox[{"{", "k2", "}"}]}], "}"}]}], "]"}]}], 
       RowBox[{"norderF", "[", 
        RowBox[{"left", ",", "right"}], "]"}]}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Commutation", " ", 
      RowBox[{"relations", ":", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"c", 
          RowBox[{"(", "k1", ")"}]}], ",", 
         RowBox[{"c", 
          RowBox[{"(", "k2", ")"}]}]}], "}"}]}]}], "=", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"c\[Dagger]", 
         RowBox[{"(", "k1", ")"}]}], ",", 
        RowBox[{"c\[Dagger]", 
         RowBox[{"(", "k2", ")"}]}]}], "}"}], "=", "0"}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"norderF", "[", 
       RowBox[{"left___", ",", 
        RowBox[{"c", "[", 
         RowBox[{"o", ",", "k1__"}], "]"}], ",", 
        RowBox[{"c", "[", 
         RowBox[{"o", ",", "k2__"}], "]"}], ",", "right___"}], "]"}], "/;", 
      RowBox[{"!", 
       RowBox[{"OrderedQ", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", "k1", "}"}], ",", 
          RowBox[{"{", "k2", "}"}]}], "}"}], "]"}]}]}], ":=", 
     RowBox[{"-", 
      RowBox[{"norderF", "[", 
       RowBox[{"left", ",", 
        RowBox[{"c", "[", 
         RowBox[{"o", ",", "k2"}], "]"}], ",", 
        RowBox[{"c", "[", 
         RowBox[{"o", ",", "k1"}], "]"}], ",", "right"}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"norderF", "[", 
       RowBox[{"left___", ",", 
        RowBox[{"c", "[", 
         RowBox[{"d", ",", "k1__"}], "]"}], ",", 
        RowBox[{"c", "[", 
         RowBox[{"d", ",", "k2__"}], "]"}], ",", "right___"}], "]"}], "/;", 
      RowBox[{"!", 
       RowBox[{"OrderedQ", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", "k1", "}"}], ",", 
          RowBox[{"{", "k2", "}"}]}], "}"}], "]"}]}]}], ":=", 
     RowBox[{"-", 
      RowBox[{"norderF", "[", 
       RowBox[{"left", ",", 
        RowBox[{"c", "[", 
         RowBox[{"d", ",", "k2"}], "]"}], ",", 
        RowBox[{"c", "[", 
         RowBox[{"d", ",", "k1"}], "]"}], ",", "right"}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"NOrderF", "[", "exp_", "]"}], ":=", 
    RowBox[{
     RowBox[{"AppToNCM", "[", 
      RowBox[{"exp", ",", "Identity", ",", "norderF"}], "]"}], "/.", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"NonCommutativeMultiply", "[", "ss__", "]"}], "\[RuleDelayed]",
        " ", "ss"}], "}"}]}]}]}]}]], "Code",
 CellChangeTimes->{{3.7637780703234615`*^9, 3.7637780893863916`*^9}, {
  3.7637782930381174`*^9, 3.7637783093784037`*^9}, {3.7637783470458364`*^9, 
  3.763778391399189*^9}, {3.763778883485684*^9, 3.763778884796616*^9}, {
  3.763778972329685*^9, 3.763779021948943*^9}, {3.763779099565866*^9, 
  3.763779159627299*^9}, {3.763780653073513*^9, 3.763780678190691*^9}, {
  3.763781564760399*^9, 
  3.7637815738849883`*^9}},ExpressionUUID->"48c76401-0be7-4d07-b1fb-\
362d68da45f1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"NCMAntiCommutator", "[", 
   RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"a", "**", "b"}], "+", 
   RowBox[{"b", "**", "a"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NCMCommutator", "[", 
   RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"a", "**", "b"}], "-", 
   RowBox[{"b", "**", "a"}]}]}]}], "Code",
 CellChangeTimes->{{3.763778452193837*^9, 3.763778457729029*^9}, {
  3.7637785194498625`*^9, 3.7637785811144896`*^9}, {3.7637789410383673`*^9, 
  3.7637789458535147`*^9}},ExpressionUUID->"fc269e18-2043-418b-ae90-\
e736751651d8"],

Cell["wick contraction", "TextIndent",
 CellChangeTimes->{{3.763779843396345*^9, 3.763779852871019*^9}, 
   3.7637815372575808`*^9},ExpressionUUID->"7c46f163-3102-4bd6-a4b8-\
37e15b282cc1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"wickcon", "[", 
    RowBox[{"___", ",", 
     RowBox[{"_", "[", 
      RowBox[{"o", ",", "__"}], "]"}]}], "]"}], ":=", "0"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"wickcon", "[", 
    RowBox[{
     RowBox[{"_", "[", 
      RowBox[{"d", ",", "__"}], "]"}], ",", "___"}], "]"}], ":=", "0"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"WickCon", "[", 
   RowBox[{"exp_", ",", "f_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"f", "[", "exp", "]"}], "/.", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"norderB", "\[Rule]", "wickcon"}], ",", 
     RowBox[{"norderF", "\[Rule]", "wickcon"}]}], "}"}]}]}]}], "Code",
 CellChangeTimes->{{3.763782122533805*^9, 3.763782125836968*^9}, {
  3.76378217674404*^9, 3.763782221479557*^9}, {3.7637823963696604`*^9, 
  3.763782432619928*^9}},ExpressionUUID->"2f43e8c9-4b66-4fbf-aac3-\
097e353878f5"],

Cell[CellGroupData[{

Cell["waste", "Passage",
 CellChangeTimes->{{3.763782586263358*^9, 
  3.763782588746701*^9}},ExpressionUUID->"2ccd4603-5dd2-4b82-a8bf-\
ce5bc175bd90"],

Cell[BoxData[{
 RowBox[{"ClearAll", "[", 
  RowBox[{"wickconB", ",", "WickConB"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"wickconB", "[", "]"}], "=", "1"}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Commutation", " ", 
     RowBox[{"relation", ":", 
      RowBox[{"[", 
       RowBox[{
        RowBox[{"a", 
         RowBox[{"(", "k1", ")"}]}], ",", 
        RowBox[{"a\[Dagger]", 
         RowBox[{"(", "k2", ")"}]}]}], "]"}]}]}], "=", 
    RowBox[{"\[Delta]", 
     RowBox[{"(", 
      RowBox[{"k1", ",", "k2"}], ")"}]}]}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"wickconB", "[", 
     RowBox[{"left___", ",", 
      RowBox[{"a", "[", 
       RowBox[{"o", ",", "k1__"}], "]"}], ",", 
      RowBox[{"a", "[", 
       RowBox[{"d", ",", "k2__"}], "]"}], ",", "right___"}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"wickconB", "[", 
      RowBox[{"left", ",", 
       RowBox[{"a", "[", 
        RowBox[{"d", ",", "k2"}], "]"}], ",", 
       RowBox[{"a", "[", 
        RowBox[{"o", ",", "k1"}], "]"}], ",", "right"}], "]"}], "+", 
     RowBox[{
      RowBox[{"Times", "@@", 
       RowBox[{"MapThread", "[", 
        RowBox[{"\[Delta]", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", "k1", "}"}], ",", 
           RowBox[{"{", "k2", "}"}]}], "}"}]}], "]"}]}], 
      RowBox[{"wickconB", "[", 
       RowBox[{"left", ",", "right"}], "]"}]}]}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Commutation", " ", 
     RowBox[{"relations", ":", 
      RowBox[{"[", 
       RowBox[{
        RowBox[{"a", 
         RowBox[{"(", "k1", ")"}]}], ",", 
        RowBox[{"a", 
         RowBox[{"(", "k2", ")"}]}]}], "]"}]}]}], "=", 
    RowBox[{
     RowBox[{"[", 
      RowBox[{
       RowBox[{"a\[Dagger]", 
        RowBox[{"(", "k1", ")"}]}], ",", 
       RowBox[{"a\[Dagger]", 
        RowBox[{"(", "k2", ")"}]}]}], "]"}], "=", "0"}]}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"wickconB", "[", 
     RowBox[{"left___", ",", 
      RowBox[{"a", "[", 
       RowBox[{"o", ",", "k1__"}], "]"}], ",", 
      RowBox[{"a", "[", 
       RowBox[{"o", ",", "k2__"}], "]"}], ",", "right___"}], "]"}], "/;", 
    RowBox[{"!", 
     RowBox[{"OrderedQ", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", "k1", "}"}], ",", 
        RowBox[{"{", "k2", "}"}]}], "}"}], "]"}]}]}], ":=", 
   RowBox[{"wickconB", "[", 
    RowBox[{"left", ",", 
     RowBox[{"a", "[", 
      RowBox[{"o", ",", "k2"}], "]"}], ",", 
     RowBox[{"a", "[", 
      RowBox[{"o", ",", "k1"}], "]"}], ",", "right"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"wickconB", "[", 
      RowBox[{"left___", ",", 
       RowBox[{"a", "[", 
        RowBox[{"d", ",", "k1__"}], "]"}], ",", 
       RowBox[{"a", "[", 
        RowBox[{"d", ",", "k2__"}], "]"}], ",", "right___"}], "]"}], "/;", 
     RowBox[{"!", 
      RowBox[{"OrderedQ", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", "k1", "}"}], ",", 
         RowBox[{"{", "k2", "}"}]}], "}"}], "]"}]}]}], ":=", 
    RowBox[{"wickconB", "[", 
     RowBox[{"left", ",", 
      RowBox[{"a", "[", 
       RowBox[{"d", ",", "k2"}], "]"}], ",", 
      RowBox[{"a", "[", 
       RowBox[{"d", ",", "k1"}], "]"}], ",", "right"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"wickconB", "[", 
    RowBox[{"___", ",", 
     RowBox[{"a", "[", 
      RowBox[{"o", ",", "__"}], "]"}]}], "]"}], ":=", "0"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"wickconB", "[", 
     RowBox[{
      RowBox[{"a", "[", 
       RowBox[{"d", ",", "__"}], "]"}], ",", "___"}], "]"}], ":=", "0"}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"WickConB", "[", "exp_", "]"}], ":=", 
  RowBox[{
   RowBox[{"AppToNCM", "[", 
    RowBox[{"exp", ",", "Identity", ",", "wickconB"}], "]"}], "/.", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"NonCommutativeMultiply", "[", "ss__", "]"}], "\[RuleDelayed]", 
     " ", "ss"}], "}"}]}]}]}], "Code",
 InitializationCell->False,
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQAWIQXTOn/d8VrjeOdTZl/0G0ovYS+atAOoyJVRFEM8Yf
UgXROWpX7EH05uW9riA647WVG4hOs5oXAKJZOLfGg+hHnf6zQXSIxJI5IHr/
HM2FIHpOWwGYZrJMPweiLyR23ATRz1cqPgPRBr0z3oLolc/Tf4JoS9mjDNeA
9ItdLYIgekLNFikQPf91gjyIfv7jF5g+9JhNBUTrvVbWANFCYscNQPSsL3pG
IPpRi4w5iF7wqN0SRD91zbEH0al/C5xA9L77Qokg+teveDCt53db6TqQPuu+
3BJEWwTUBoDo57GPg0H0rjehP0H0BqFFYBoAYVehdA==
  "],ExpressionUUID->"6d435f6c-1ee2-48c6-a992-dce3225a785b"],

Cell[BoxData[{
 RowBox[{"ClearAll", "[", 
  RowBox[{"wickconF", ",", "WickConF"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"wickconF", "[", "]"}], "=", "1"}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Commutation", " ", 
     RowBox[{"relation", ":", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"c", 
         RowBox[{"(", "k1", ")"}]}], ",", 
        RowBox[{"c\[Dagger]", 
         RowBox[{"(", "k2", ")"}]}]}], "}"}]}]}], "=", 
    RowBox[{"\[Delta]", 
     RowBox[{"(", 
      RowBox[{"k1", ",", "k2"}], ")"}]}]}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"wickconF", "[", 
     RowBox[{"left___", ",", 
      RowBox[{"c", "[", 
       RowBox[{"o", ",", "k1__"}], "]"}], ",", 
      RowBox[{"c", "[", 
       RowBox[{"d", ",", "k2__"}], "]"}], ",", "right___"}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"-", 
      RowBox[{"wickconF", "[", 
       RowBox[{"left", ",", 
        RowBox[{"c", "[", 
         RowBox[{"d", ",", "k2"}], "]"}], ",", 
        RowBox[{"c", "[", 
         RowBox[{"o", ",", "k1"}], "]"}], ",", "right"}], "]"}]}], "+", 
     RowBox[{
      RowBox[{"Times", "@@", 
       RowBox[{"MapThread", "[", 
        RowBox[{"\[Delta]", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", "k1", "}"}], ",", 
           RowBox[{"{", "k2", "}"}]}], "}"}]}], "]"}]}], 
      RowBox[{"wickconF", "[", 
       RowBox[{"left", ",", "right"}], "]"}]}]}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Commutation", " ", 
     RowBox[{"relations", ":", 
      RowBox[{"[", 
       RowBox[{
        RowBox[{"a", 
         RowBox[{"(", "k1", ")"}]}], ",", 
        RowBox[{"a", 
         RowBox[{"(", "k2", ")"}]}]}], "]"}]}]}], "=", 
    RowBox[{
     RowBox[{"[", 
      RowBox[{
       RowBox[{"a\[Dagger]", 
        RowBox[{"(", "k1", ")"}]}], ",", 
       RowBox[{"a\[Dagger]", 
        RowBox[{"(", "k2", ")"}]}]}], "]"}], "=", "0"}]}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"wickconF", "[", 
     RowBox[{"left___", ",", 
      RowBox[{"c", "[", 
       RowBox[{"o", ",", "k1__"}], "]"}], ",", 
      RowBox[{"c", "[", 
       RowBox[{"o", ",", "k2__"}], "]"}], ",", "right___"}], "]"}], "/;", 
    RowBox[{"!", 
     RowBox[{"OrderedQ", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", "k1", "}"}], ",", 
        RowBox[{"{", "k2", "}"}]}], "}"}], "]"}]}]}], ":=", 
   RowBox[{"-", 
    RowBox[{"wickconF", "[", 
     RowBox[{"left", ",", 
      RowBox[{"c", "[", 
       RowBox[{"o", ",", "k2"}], "]"}], ",", 
      RowBox[{"c", "[", 
       RowBox[{"o", ",", "k1"}], "]"}], ",", "right"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"wickconF", "[", 
      RowBox[{"left___", ",", 
       RowBox[{"c", "[", 
        RowBox[{"d", ",", "k1__"}], "]"}], ",", 
       RowBox[{"c", "[", 
        RowBox[{"d", ",", "k2__"}], "]"}], ",", "right___"}], "]"}], "/;", 
     RowBox[{"!", 
      RowBox[{"OrderedQ", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", "k1", "}"}], ",", 
         RowBox[{"{", "k2", "}"}]}], "}"}], "]"}]}]}], ":=", 
    RowBox[{"-", 
     RowBox[{"wickconF", "[", 
      RowBox[{"left", ",", 
       RowBox[{"a", "[", 
        RowBox[{"d", ",", "k2"}], "]"}], ",", 
       RowBox[{"a", "[", 
        RowBox[{"d", ",", "k1"}], "]"}], ",", "right"}], "]"}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"wickconF", "[", 
    RowBox[{"___", ",", 
     RowBox[{"c", "[", 
      RowBox[{"o", ",", "__"}], "]"}]}], "]"}], ":=", "0"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"wickconF", "[", 
     RowBox[{
      RowBox[{"c", "[", 
       RowBox[{"d", ",", "__"}], "]"}], ",", "___"}], "]"}], ":=", "0"}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"WickConF", "[", "exp_", "]"}], ":=", 
  RowBox[{
   RowBox[{"AppToNCM", "[", 
    RowBox[{"exp", ",", "Identity", ",", "wickconF"}], "]"}], "/.", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"NonCommutativeMultiply", "[", "ss__", "]"}], "\[RuleDelayed]", 
     " ", "ss"}], "}"}]}]}]}], "Code",
 InitializationCell->False,
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQBWIQXTOn/d8VrjeOdTZl/0G0ovYS+atAOoyJVRFEM8Yf
UgXROWpX7EH05uW9riA647WVG4hOs5oXAKJZOLfGg+hHnf6zQXSIxJI5IHr/
HM2FIHpOWwGYZrJMPweiLyR23ATRz1cqPgPRBr0z3oLolc/Tf4JoS9mjDNeA
9ItdLYIgekLNFikQPf91gjyIfv7jF5g+9JhNBUTrvVbWANFCYscNQPSsL3pG
IPpRi4w5iF7wqN0SRD91zbEH0al/C5xA9L77Qokg+teveDCt53db6TqQPuu+
3BJEL1q0xhFEGzlN9QbR7HPOhYBoxs4bYSB63bt/v0D08SVxv0E0AKPpqcs=

  "],ExpressionUUID->"e201bec4-cbc4-4495-83c2-85c7bb6ac049"]
}, Closed]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{817, 661},
WindowMargins->{{128, Automatic}, {Automatic, 32}},
Magnification:>1.2 Inherited,
FrontEndVersion->"11.2 for Microsoft Windows (64-bit) (2017\:5e749\:670810\
\:65e5)",
StyleDefinitions->"Cambria Article.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 201, 4, 35, "Input",ExpressionUUID->"2d395793-0438-4fb6-b573-c8cc47d0d648"],
Cell[762, 26, 130, 3, 35, "Input",ExpressionUUID->"d3bd016d-6cb7-4cc6-800d-06eabfbe5c2e"],
Cell[CellGroupData[{
Cell[917, 33, 158, 3, 87, "Section",ExpressionUUID->"c9243699-47ec-4960-a666-41d202c80aca"],
Cell[CellGroupData[{
Cell[1100, 40, 169, 3, 50, "Subsection",ExpressionUUID->"c15a5372-ace8-4823-9bde-315fae516ec0"],
Cell[1272, 45, 3643, 95, 282, "Code",ExpressionUUID->"261cdb7c-b37c-4cf8-83df-58d6b7c43a9d"],
Cell[CellGroupData[{
Cell[4940, 144, 161, 3, 34, "Subsubsubsection",ExpressionUUID->"ffa9f850-4d35-48b3-a8bf-2c8c5deb95e5"],
Cell[CellGroupData[{
Cell[5126, 151, 238, 6, 72, "Input",ExpressionUUID->"7ba7efba-b186-4d04-b0fc-0922d135a63f"],
Cell[5367, 159, 159, 3, 72, "Output",ExpressionUUID->"f821b3fe-0c6f-41f0-a1c4-4092995cd374"]
}, Open  ]],
Cell[CellGroupData[{
Cell[5563, 167, 213, 5, 72, "Input",ExpressionUUID->"291fbe94-32a2-477e-b355-ec50af32f88d"],
Cell[5779, 174, 214, 5, 72, "Output",ExpressionUUID->"df424fc7-bd53-43b3-957c-644eb4f4597f"]
}, Open  ]],
Cell[CellGroupData[{
Cell[6030, 184, 793, 19, 72, "Input",ExpressionUUID->"7cd8eaa6-df81-4d8a-b135-7bfeb2517980"],
Cell[6826, 205, 706, 18, 72, "Output",ExpressionUUID->"06d539db-fe1c-4007-8ef4-ab4c3a17d634"]
}, Open  ]],
Cell[CellGroupData[{
Cell[7569, 228, 614, 10, 72, "Input",ExpressionUUID->"55d6fc69-fd85-4faf-8aae-55715f21379b"],
Cell[8186, 240, 989, 22, 72, "Output",ExpressionUUID->"e43daa7b-8c28-486a-8b7e-fe2a2bebeb2c"]
}, Open  ]],
Cell[CellGroupData[{
Cell[9212, 267, 228, 5, 72, "Input",ExpressionUUID->"0708eac9-61c7-4edc-92ef-94b063ac71d6"],
Cell[9443, 274, 167, 4, 72, "Output",ExpressionUUID->"bf5c6b9a-c153-4c8a-9791-f968e1b67ccd"]
}, Open  ]],
Cell[CellGroupData[{
Cell[9647, 283, 190, 4, 72, "Input",ExpressionUUID->"20df9110-dff1-4a06-92ea-e641404fda40"],
Cell[9840, 289, 151, 3, 72, "Output",ExpressionUUID->"c10fb15f-45aa-448f-8a2a-8e4535c81be0"]
}, Open  ]],
Cell[CellGroupData[{
Cell[10028, 297, 260, 7, 72, "Input",ExpressionUUID->"2bf655b4-094d-48b4-9ccf-73fd513a0604"],
Cell[10291, 306, 161, 3, 72, "Output",ExpressionUUID->"46a7e792-cd7d-4bd1-9eb4-ce2f7da1164e"]
}, Open  ]]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[10513, 316, 167, 3, 40, "Subsection",ExpressionUUID->"bdf0b498-514d-4452-8435-e10bf4169263"],
Cell[10683, 321, 445, 11, 30, "TextIndent",ExpressionUUID->"fe216450-10da-49b3-a9e6-87c26e94031e"],
Cell[11131, 334, 1618, 48, 172, "Code",ExpressionUUID->"1aecc2d9-9734-4c3e-8205-62fb26b72b0c"],
Cell[12752, 384, 1207, 32, 84, "Code",ExpressionUUID->"507a85f6-8c1a-4f13-8748-c0b941dac80d"],
Cell[13962, 418, 325, 7, 54, "TextIndent",ExpressionUUID->"dfc7c9f0-e6dd-4d51-9de3-98441bf7c8fc"],
Cell[14290, 427, 598, 17, 39, "DisplayFormulaNumbered",ExpressionUUID->"5437fefd-68cc-4d02-8005-d2ff7a58afaf"],
Cell[14891, 446, 3841, 98, 294, "Code",ExpressionUUID->"25bfd6d9-431c-4700-867e-654ccb1a523e"],
Cell[CellGroupData[{
Cell[18757, 548, 638, 16, 42, "Input",ExpressionUUID->"6c6387db-4b77-44bb-9835-191f6f5078c5"],
Cell[19398, 566, 7563, 150, 198, "Output",ExpressionUUID->"f39e50ba-0d44-4f72-bdf9-13a8b3af7444"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[27010, 722, 230, 4, 60, "Subsection",ExpressionUUID->"bfe1e2d7-08cb-4120-be64-04628fb1da3a"],
Cell[27243, 728, 836, 21, 280, "Input",ExpressionUUID->"974dde74-6567-4736-9632-5b1c770d2d3c"],
Cell[28082, 751, 293, 6, 64, "TextIndent",ExpressionUUID->"a1ef068c-056c-4597-a874-5a32e00fbe94"],
Cell[28378, 759, 504, 13, 48, "DisplayFormulaNumbered",ExpressionUUID->"1bcec8e2-7ded-4015-8239-46dc77187852"],
Cell[28885, 774, 1670, 52, 120, "DisplayFormulaNumbered",ExpressionUUID->"61cd1c9f-c49e-4966-a7e1-b8e28436ba06"],
Cell[30558, 828, 4290, 128, 338, "Code",ExpressionUUID->"2030d471-0a4b-49ee-8fb9-4fa8ff550681"],
Cell[34851, 958, 1898, 58, 120, "DisplayFormulaNumbered",ExpressionUUID->"959b0d7a-3009-41d5-8f45-985351b0d70e"],
Cell[36752, 1018, 4651, 133, 364, "Code",ExpressionUUID->"48c76401-0be7-4d07-b1fb-362d68da45f1"],
Cell[41406, 1153, 613, 16, 100, "Code",ExpressionUUID->"fc269e18-2043-418b-ae90-e736751651d8"],
Cell[42022, 1171, 189, 3, 36, "TextIndent",ExpressionUUID->"7c46f163-3102-4bd6-a4b8-37e15b282cc1"],
Cell[42214, 1176, 913, 27, 127, "Code",ExpressionUUID->"2f43e8c9-4b66-4fbf-aac3-097e353878f5"],
Cell[CellGroupData[{
Cell[43152, 1207, 150, 3, 40, "Passage",ExpressionUUID->"2ccd4603-5dd2-4b82-a8bf-ce5bc175bd90"],
Cell[43305, 1212, 4783, 144, 504, "Code",ExpressionUUID->"6d435f6c-1ee2-48c6-a992-dce3225a785b",
 InitializationCell->False],
Cell[48091, 1358, 4878, 148, 504, "Code",ExpressionUUID->"e201bec4-cbc4-4495-83c2-85c7bb6ac049",
 InitializationCell->False]
}, Closed]]
}, Open  ]]
}, Open  ]]
}
]
*)

